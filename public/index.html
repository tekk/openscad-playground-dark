<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>OpenSCAD Playground</title>
    <meta name="description" content="OpenSCAD Playground: edit .scad models and render them to STL from the browser (WebAssembly build OpenSCAD, with Monaco editor and STL Viewer)">

    <link rel="icon" href="favicon.ico">
    <link rel="apple-touch-icon" href="logo192.png">
    <!-- https://developers.google.com/web/fundamentals/web-app-manifest/ -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e1e1e">

    <link rel="prefetch" href="openscad.wasm">
    <link rel="prefetch" href="openscad-worker.js">
    <link rel="prefetch" href="libraries/fonts.zip">

    <link rel="prefetch" href="libraries/MCAD.zip">
    <link rel="prefetch" href="libraries/BOSL2.zip">
    <link rel="prefetch" href="libraries/BOSL.zip">
    <link rel="prefetch" href="libraries/NopSCADlib.zip">
    <link rel="prefetch" href="libraries/FunctionalOpenSCAD.zip">
    <link rel="prefetch" href="libraries/funcutils.zip">
    <link rel="prefetch" href="libraries/smooth-prim.zip">
    <link rel="prefetch" href="libraries/closepoints.zip">
    <link rel="prefetch" href="libraries/plot-function.zip">
    <link rel="prefetch" href="libraries/YAPP_Box.zip">
    <link rel="prefetch" href="libraries/Stemfie_OpenSCAD.zip">
    <link rel="prefetch" href="libraries/UB.scad.zip">
    <link rel="prefetch" href="libraries/openscad-tray.zip">

    <script type="module" src="./model-viewer.min.js" defer></script>
    <script src="./browserfs.min.js" defer></script>

    <script src="./index.js" defer></script>

    <link rel="stylesheet" href="./css/theme.css">
    <link rel="stylesheet" href="./css/primereact.min.css">

    <style>
      /* Theme toggle button styles */
      .theme-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        width: 48px;
        height: 48px;
        border-radius: 50%;
        border: 2px solid rgba(255, 255, 255, 0.2);
        background: rgba(255, 255, 255, 0.1);
        color: white;
        font-size: 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .theme-toggle:hover {
        background: rgba(255, 255, 255, 0.2);
        border-color: rgba(255, 255, 255, 0.3);
      }

      .theme-toggle.dark {
        background: rgba(0, 0, 0, 0.1);
        border-color: rgba(0, 0, 0, 0.2);
        color: #333;
      }

      .theme-toggle.dark:hover {
        background: rgba(0, 0, 0, 0.2);
        border-color: rgba(0, 0, 0, 0.3);
      }

      /* Light theme body styles (default) */
      body:not(.dark-theme) {
        background-color: #ffffff !important;
        color: #333333 !important;
      }

      /* Dark theme body styles */
      .dark-theme {
        background-color: #1e1e1e !important;
        color: rgba(255, 255, 255, 0.87) !important;
      }

      /* Ensure TreeSelect components reflect theme changes */
      body:not(.dark-theme) .p-treeselect {
        background-color: #ffffff !important;
        color: #333333 !important;
      }

      .dark-theme .p-treeselect {
        background-color: #2d3748 !important;
        color: rgba(255, 255, 255, 0.87) !important;
      }

      body:not(.dark-theme) .p-treeselect-panel,
      body:not(.dark-theme) .p-treeselect .p-connected-overlay,
      body:not(.dark-theme) .p-connected-overlay,
      body:not(.dark-theme) .p-treeselect-panel .p-treeselect-header,
      body:not(.dark-theme) .p-treeselect-panel .p-treeselect-items-wrapper {
        background-color: #ffffff !important;
        color: #333333 !important;
      }

      .dark-theme .p-treeselect-panel,
      .dark-theme .p-treeselect .p-connected-overlay,
      .dark-theme .p-connected-overlay,
      .dark-theme .p-treeselect-panel .p-treeselect-header,
      .dark-theme .p-treeselect-panel .p-treeselect-items-wrapper {
        background-color: #2d3748 !important;
        color: rgba(255, 255, 255, 0.87) !important;
      }
      #root,
      body,
      html {
        display: flex;
        flex-direction: column;
        flex: 1;
        margin: 0;

        height: 100vh;
        height: var(--app-height);
        background-color: var(--app-bg-color, #1e1e1e);
        color: var(--app-text-color, rgba(255, 255, 255, 0.87));
      }


      .p-fieldset .p-fieldset-content {
        padding: 0 !important;
      }

      .p-fieldset-legend,
      .p-fieldset-content {
        padding-top: 0 !important;
        padding-bottom: 0 !important;
      }

      .absolute-fill {
        position: absolute;
        top: 0;
        right: 0;
        left: 0;
        bottom: 0;
      }

      textarea.openscad-editor {
        font-family: "Droid Sans Mono", "monospace", monospace;
        font-weight: normal;
        font-size: 16px;
        font-feature-settings: "liga" 0, "calt" 0;
        line-height: 22px;
        letter-spacing: 0px;
      }

      .opacity-animated {
        transition: opacity 0.5s ease-in-out;
      }
      .opacity-0 {
        opacity: 0;
      }

    </style>
  </head>
  <body>
    <audio id="complete-sound">
      <source src="complete.wav" type="audio/wav">
      Your browser does not support the audio element.
    </audio>

    <noscript>You need to enable JavaScript to run the OpenSCAD Playground.</noscript>
    <div id="root"></div>

    <!-- Theme toggle button -->
    <button id="theme-toggle" class="theme-toggle" onclick="toggleTheme()" title="Toggle Dark/Light Mode">
      üåô
    </button>

    <script>
      // Theme toggle functionality
      function toggleTheme() {
        const body = document.body;
        const themeToggle = document.getElementById('theme-toggle');
        const isDark = body.classList.contains('dark-theme');

        if (isDark) {
          // Switch to light theme
          body.classList.remove('dark-theme');
          themeToggle.classList.remove('dark');
          themeToggle.innerHTML = '‚òÄÔ∏è';
          themeToggle.title = 'Switch to Dark Mode';

          // Update body background for light theme
          document.documentElement.style.setProperty('--app-bg-color', '#ffffff');
          document.documentElement.style.setProperty('--app-text-color', '#333333');

          // Update PrimeReact theme
          const existingTheme = document.getElementById('primereact-theme-css');
          if (existingTheme) {
            existingTheme.href = 'primereact/resources/themes/lara-light-indigo/theme.css';
          } else {
            const link = document.createElement('link');
            link.id = 'primereact-theme-css';
            link.rel = 'stylesheet';
            link.href = 'primereact/resources/themes/lara-light-indigo/theme.css';
            document.head.appendChild(link);
          }

          // Update Monaco editor theme if available
          if (window.monaco) {
            window.monaco.editor.setTheme('vs');
          }
        } else {
          // Switch to dark theme
          body.classList.add('dark-theme');
          themeToggle.classList.add('dark');
          themeToggle.innerHTML = 'üåô';
          themeToggle.title = 'Switch to Light Mode';

          // Update body background for dark theme
          document.documentElement.style.setProperty('--app-bg-color', '#1e1e1e');
          document.documentElement.style.setProperty('--app-text-color', 'rgba(255, 255, 255, 0.87)');

          // Update PrimeReact theme
          const existingTheme = document.getElementById('primereact-theme-css');
          if (existingTheme) {
            existingTheme.href = 'primereact/resources/themes/lara-dark-indigo/theme.css';
          } else {
            const link = document.createElement('link');
            link.id = 'primereact-theme-css';
            link.rel = 'stylesheet';
            link.href = 'primereact/resources/themes/lara-dark-indigo/theme.css';
            document.head.appendChild(link);
          }

          // Update Monaco editor theme if available
          if (window.monaco) {
            window.monaco.editor.setTheme('vs-dark');
          }
        }

        // Save theme preference (only save if explicitly chosen, default is dark)
        if (!isDark) {
          localStorage.setItem('theme', 'light');
        } else {
          localStorage.removeItem('theme'); // Default is dark, so remove any saved preference
        }
      }

      // Load saved theme preference
      document.addEventListener('DOMContentLoaded', function() {
        const savedTheme = localStorage.getItem('theme');
        const themeToggle = document.getElementById('theme-toggle');

        if (savedTheme === 'light') {
          // Start with light theme
          document.body.classList.remove('dark-theme');
          themeToggle.classList.remove('dark');
          themeToggle.innerHTML = '‚òÄÔ∏è';
          themeToggle.title = 'Switch to Dark Mode';

          // Set light theme CSS variables
          document.documentElement.style.setProperty('--app-bg-color', '#ffffff');
          document.documentElement.style.setProperty('--app-text-color', '#333333');
        } else {
          // Default to dark theme (as requested)
          document.body.classList.add('dark-theme');
          themeToggle.classList.add('dark');
          themeToggle.innerHTML = 'üåô';
          themeToggle.title = 'Switch to Light Mode';

          // Set dark theme CSS variables as default
          document.documentElement.style.setProperty('--app-bg-color', '#1e1e1e');
          document.documentElement.style.setProperty('--app-text-color', 'rgba(255, 255, 255, 0.87)');
        }
      });
    </script>
  </body>
</html>
